{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Casulo{% endblock %}</title>

    <link rel="icon" type="image/x-icon" href="{% static 'images/casulo.ico' %}" />
    <link rel="stylesheet" href="{% static 'css/output.css' %}" />
    <script src="{% static 'js/theme.js' %}"></script>
    <script defer src="{% static 'js/carousel.js' %}"></script>
    <script defer src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body x-data class="selection:bg-secondary/70 selection:text-secondary-foreground">

    <nav
      x-data="{
    open:false,
    scrolled:false,
    init(){
      const onScroll = () => { this.scrolled = window.scrollY > 20 }
      onScroll()
      window.addEventListener('scroll', onScroll, { passive:true })
    }
  }"
      class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
      :class="scrolled
    ? 'bg-card/75 backdrop-blur-md shadow-md border-b border-border'
    : 'bg-transparent'"
    >
      <div class="mx-auto max-w-6xl px-4 lg:px-8">
        <div class="flex h-20 items-center justify-between gap-3">
          <!-- Logo -->
          <a href="{% url 'landpage' %}" class="flex items-center gap-2">
            <img
              src="{% static 'images/LogoDinamico.gif' %}"
              alt="Clínica Casulo"
              class="h-12 w-auto lg:mb-4"
            />
          </a>

          <!-- Desktop links -->
          {% if request.path|slice:":8" != "/painel/" %}
          <div class="hidden items-center gap-8 lg:flex">
            <a
              href="#sobre"
              class="text-sm font-medium text-foreground/80 hover:text-primary transition-colors"
              >Sobre</a
            >
            <a
              href="#servicos"
              class="text-sm font-medium text-foreground/80 hover:text-primary transition-colors"
              >Serviços</a
            >
            <a
              href="#equipe"
              class="text-sm font-medium text-foreground/80 hover:text-primary transition-colors"
            >
              Equipe
            </a>

            <a
              href="#espaco"
              class="text-sm font-medium text-foreground/80 hover:text-primary transition-colors"
              >Espaço</a
            >


          </div>
          {% endif %}

          <!-- Desktop CTA + auth -->
          <div class="hidden items-center gap-4 lg:flex">
            {% if request.path|slice:":8" == "/painel/" %}
            <a
              href="{% url 'landpage' %}"
              class="inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-medium text-primary-foreground hover:opacity-90 transition"
            >
              Voltar ao site
            </a>

            {% if user.is_authenticated %}
            <button
              type="button"
              class="btn btn-danger rounded-full"
              @click="$dispatch('confirm', {
                title: 'Sair',
                text: 'Tem certeza que deseja sair?',
                action: '{% url 'logout_confirm' %}'
              })"
            >
              Sair
            </button>
              {% else %}
              {% if request.resolver_match.url_name != 'login' %}
            <a
              href="{% url 'login' %}"
              class="rounded-full px-4 py-2 text-sm text-foreground/80 hover:bg-accent transition"
            >
              Entrar
            </a>
              {% endif %}
              {% endif %}
            {% else %}
            <a
              href="#contato"
              class="inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-medium text-primary-foreground hover:opacity-90 transition"
            >
              Agendar Consulta
            </a>
            {% endif %}
          </div>

          <!-- Mobile button -->
          <button
            type="button"
            class="lg:hidden inline-flex items-center justify-center rounded-xl border bg-card/30 px-3 py-2 text-sm text-foreground hover:bg-card transition"
            @click="open = !open"
            @click.away="open = false"
            :aria-expanded="open"
            aria-controls="mobile-menu"
          >
            <span x-show="!open" aria-hidden="true">
              <i data-lucide="menu" class="h-5 w-5"></i>
            </span>
            <span x-show="open" x-cloak aria-hidden="true">
              <i data-lucide="x" class="h-5 w-5"></i>
            </span>
          </button>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="lg:hidden" x-show="open" x-transition>
          <div
            class="mb-3 rounded-2xl border border-border bg-card/95 p-3 shadow-md backdrop-blur"
          >
            <div class="flex flex-col gap-2">
              {% if request.path|slice:":8" != "/painel/" %}
              <a
                @click="open=false"
                href="#sobre"
                class="rounded-xl px-3 py-2 text-sm font-medium text-foreground/80 hover:bg-accent transition"
                >Sobre</a
              >
              <a
                @click="open=false"
                href="#servicos"
                class="rounded-xl px-3 py-2 text-sm font-medium text-foreground/80 hover:bg-accent transition"
                >Serviços</a
              >
              <a
                @click="open=false"
                href="#equipe"
                class="rounded-xl px-3 py-2 text-sm font-medium text-foreground/80 hover:bg-accent transition"
              >
                Equipe
              </a>


              <a
                @click="open=false"
                href="#espaco"
                class="rounded-xl px-3 py-2 text-sm font-medium text-foreground/80 hover:bg-accent transition"
                >Espaço</a
              >


              {% endif %}

              <div class="my-2 border-t border-border"></div>

              {% if request.path|slice:":8" == "/painel/" %}
              <a
                @click="open=false"
                href="{% url 'landpage' %}"
                class="mt-1 inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-medium text-primary-foreground hover:opacity-90 transition"
              >
                Voltar ao site
              </a>
              {% else %}
              <a
                @click="open=false"
                href="#contato"
                class="mt-1 inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-medium text-primary-foreground hover:opacity-90 transition"
              >
                Agendar Consulta
              </a>
              {% endif %}

              {% if request.path|slice:":8" == "/painel/" %}
                {% if user.is_authenticated %}
              <button
                type="button"
                class="mt-2 btn btn-danger rounded-full"
                @click="open=false; $dispatch('confirm', {
                  title: 'Sair',
                  text: 'Tem certeza que deseja sair?',
                  action: '{% url 'logout_confirm' %}'
                })"
              >
                Sair
              </button>
                {% else %}
                {% if request.resolver_match.url_name != 'login' %}
              <a
                @click="open=false"
                href="{% url 'login' %}"
                class="mt-2 rounded-full px-4 py-2 text-sm text-foreground/80 hover:bg-accent transition text-center"
              >
                Entrar
              </a>
                {% endif %}
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div class="min-h-screen">
      {% block content %}{% endblock %}
    </div>
    {% include "partials/footer.html" %}

    <!-- Floating Theme Toggle -->
    <button
      type="button"
      class="fixed bottom-2 right-2 lg:bottom-6 lg:right-6 z-50 inline-flex items-center justify-center h-10 w-10 rounded-full border border-border bg-card/70 text-foreground/80 shadow-sm backdrop-blur hover:bg-accent hover:text-foreground transition focus-visible:ring-1 focus-visible:ring-ring/50"
      onclick="window.toggleTheme()"
      aria-label="Alternar tema"
      title="Alternar tema"
    >
      <i data-lucide="sun" class="h-4 w-4 hidden dark:block"></i>
      <i data-lucide="moon" class="h-4 w-4 block dark:hidden"></i>
    </button>

    <div
      x-data="{ open:false, title:'', text:'', action:'#', htmx:false, target:'', swap:'' }"
      x-on:confirm.window="
    open = true;
    title = $event.detail.title;
    text = $event.detail.text;
    action = $event.detail.action;
    htmx = $event.detail.htmx || false;
    target = $event.detail.target || '';
    swap = $event.detail.swap || '';
  "
      x-show="open"
      x-cloak
      class="fixed inset-0 z-60"
    >
      <!-- overlay -->
      <div
        class="absolute inset-0 bg-card-foreground/20 backdrop-blur-sm"
        @click="open=false"
      ></div>

      <!-- modal -->
      <div class="relative flex min-h-full items-center justify-center p-4">
        <div class="w-full max-w-md rounded-2xl border bg-card shadow-xl overflow-hidden">
          <div class="px-5 py-4 border-b">
            <h2
              class="text-lg font-semibold text-foreground"
              x-text="title"
            ></h2>
          </div>

          <div class="px-5 py-4">
            <p class="text-sm text-muted-foreground" x-text="text"></p>
          </div>

          <div
            class="flex items-center justify-end gap-3 bg-muted/50 px-6 py-4"
          >
            <button type="button" class="btn btn-ghost" @click="open=false">
              Cancelar
            </button>

            <form
              method="post"
              :action="htmx ? null : action"
              :hx-post="htmx ? action : null"
              :hx-target="htmx ? target : null"
              :hx-swap="htmx ? swap : null"
              @htmx:afterRequest="open=false"
            >
              {% csrf_token %}
              <button type="submit" class="btn btn-danger">Confirmar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script defer src="{% static 'js/htmx-csrf.js' %}"></script>
    <script defer src="{% static 'js/messages-list.js' %}"></script>
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <script defer src="{% static 'js/ui.js' %}"></script>
  </body>
</html>
