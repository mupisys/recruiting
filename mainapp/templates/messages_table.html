<section class="messages-table card card-table overflow-hidden p-0 h-[600px] flex flex-col"
         hx-trigger="refresh-messages from:document"
         hx-get="{% url 'admin' %}"
         hx-include="#filter-form"
         hx-select=".messages-table"
         hx-swap="outerHTML">
  <div class="overflow-y-auto custom-scrollbar flex-grow">
    <table class="w-full text-sm text-left">
      <thead class="sticky top-0 z-10 text-xs text-secondary uppercase bg-surface border-b border-border">
        <tr>
          <th class="px-6 py-3 w-16">ID</th>
          <th class="px-6 py-3">Nome</th>
          <th class="px-6 py-3">Email</th>
          <th class="px-6 py-3">Mensagem</th>
          <th class="px-6 py-3 w-32 text-center">Lido</th>
          <th class="px-6 py-3 w-40">Data</th>
          <th class="px-6 py-3 text-right">Ações</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-border">
        {% for msg in message_list %}
        <tr class="group">
          <td class="px-6 py-4 text-secondary font-mono text-xs">#{{ msg.id }}</td>
          <td class="px-6 py-4 font-medium text-primary">{{ msg.name }}</td>
          <td class="px-6 py-4 text-secondary">{{ msg.email }}</td>
          <td class="px-6 py-4 text-secondary max-w-[200px] truncate" title="{{ msg.message }}">{{ msg.short_message }}</td>
          <td class="px-6 py-4 text-center">
            <button type="button"
                    class="toggle-read inline-flex items-center justify-center transition-opacity hover:opacity-80 focus:outline-none"
                    hx-post="{% url 'toggle_message_read' msg.pk %}"
                    hx-target="#read-text-{{ msg.pk }}"
                    hx-swap="outerHTML"
                    hx-select="unset">
              <span id="read-text-{{ msg.pk }}" class="badge badge--compact {% if msg.read %}badge--accent{% else %}badge--ice{% endif %}">
                {{ msg.read|yesno:"Sim,Não" }}
              </span>
            </button>
          </td>
          <td class="px-6 py-4 text-secondary whitespace-nowrap">{{ msg.formatted_date }}</td>
          <td class="px-6 py-4 text-right space-x-2">
            <button type="button" 
                    class="btn btn-secondary text-xs"
                    hx-get="{% url 'message_detail' msg.pk %}"
                    hx-target="#modal-content"
                    hx-swap="innerHTML"
                    hx-select="unset">Ver</button>
            {% if is_dev %}
            <button type="button" 
                    class="btn btn-secondary text-xs"
                    hx-get="{% url 'message_edit' msg.pk %}"
                    hx-target="#modal-content"
                    hx-swap="innerHTML"
                    hx-select="unset">Editar</button>
            <button type="button" 
                    class="btn btn-primary text-xs"
                    hx-get="{% url 'message_delete_confirm' msg.pk %}"
                    hx-target="#modal-content"
                    hx-swap="innerHTML"
                    hx-select="unset">Excluir</button>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="7" class="px-6 py-12 text-center text-secondary">Nenhuma mensagem encontrada.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
