<section class="messages-table"
         hx-trigger="refresh-messages from:document"
         hx-get="{% url 'admin' %}"
         hx-select=".messages-table"
         hx-swap="outerHTML">
  <h2>Todas as Mensagens</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Email</th>
        <th>Lido</th>
        <th>Data</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for msg in messages %}
      <tr>
        <td>{{ msg.id }}</td>
        <td>{{ msg.name }}</td>
        <td>{{ msg.email }}</td>
        <td>
          <button type="button"
                  class="toggle-read"
                  hx-post="{% url 'toggle_message_read' msg.pk %}"
                  hx-target="#read-text-{{ msg.pk }}"
                  hx-swap="outerHTML"
                  hx-select="unset">
            <span id="read-text-{{ msg.pk }}" class="read-status">{{ msg.read|yesno:"Sim,Não" }}</span>
          </button>
        </td>
        <td>{{ msg.formatted_date }}</td>
        <td>
          <button type="button" 
                  hx-get="{% url 'message_detail' msg.pk %}"
                  hx-target="#modal-content"
                  hx-swap="innerHTML"
                  hx-select="unset"
                  onclick="window.dispatchEvent(new CustomEvent('modal-open'))">Ver</button>
          {% if is_dev %}
          <button type="button" 
                  hx-get="{% url 'message_edit' msg.pk %}"
                  hx-target="#modal-content"
                  hx-swap="innerHTML"
                  hx-select="unset"
                  onclick="window.dispatchEvent(new CustomEvent('modal-open'))">Editar</button>
          <button type="button" 
                  hx-get="{% url 'message_delete_confirm' msg.pk %}"
                  hx-target="#modal-content"
                  hx-swap="innerHTML"
                  hx-select="unset"
                  onclick="window.dispatchEvent(new CustomEvent('modal-open'))">Excluir</button>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6">Nenhuma mensagem.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
