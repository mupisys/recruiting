{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Mupi Recruiting{% endblock %}</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="{% static 'js/tailwind-config.js' %}"></script>

  <!-- HTMX & Alpine -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js" defer></script>
  
  <meta name="csrf-token" content="{{ csrf_token }}">
  <script src="{% static 'js/htmx-setup.js' %}?v=1"></script>

  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=27">

  {% block extra_head %}{% endblock %}
</head>
<body class="text-white font-sans antialiased min-h-screen flex flex-col"
      x-data="{ modalOpen: false }"
      @modal-open.window="modalOpen = true"
      @modal-close.window="modalOpen = false"
      @keydown.escape.window="modalOpen = false">

  <!-- Solid Background Layer -->
  <div class="fixed inset-0 bg-background pointer-events-none" style="z-index: -50;"></div>

  <!-- Background Effects: Top Spotlight (Timeless) -->
  <div class="fixed inset-0 pointer-events-none" style="z-index: -10;">
    <!-- Soft light emerging from the top center -->
    <div class="absolute inset-0 w-full h-full bg-spotlight"></div>
  </div>

  <!-- Global Theme Toggle (can be overridden by templates that have their own) -->

  {% block content %}{% endblock %}

  <!-- Global Modal -->
  <div id="modal-container" 
       x-show="modalOpen" 
       style="display: none;"
       class="fixed inset-0 z-50 overflow-y-auto" 
       aria-labelledby="modal-title" 
       role="dialog" 
       aria-modal="true">
       
    <!-- Backdrop -->
    <div x-show="modalOpen"
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/40 backdrop-blur-md transition-opacity"></div>

    <!-- Panel Container -->
    <div class="flex min-h-full items-center justify-center p-4 text-center">
      <div x-show="modalOpen"
           @click.away="modalOpen = false"
           x-data="{ 
             swapping: false,
             currentHeight: 'auto'
           }"
           @htmx:before-swap.window="
             if($event.detail.target.id === 'modal-content' && modalOpen) {
               swapping = true;
               // Lock current height to prevent instant collapse
               currentHeight = $el.offsetHeight + 'px';
             }
           "
           @htmx:after-swap.window="
             if($event.detail.target.id === 'modal-content' && modalOpen) {
               // Unlock height to measure new content
               let prevHeight = currentHeight;
               currentHeight = 'auto'; 
               
               // Use nextTick to allow DOM to update
               $nextTick(() => {
                 // Measure new natural height
                 let newHeight = $el.offsetHeight + 'px';
                 
                 // Snap back to previous height instantly
                 currentHeight = prevHeight;
                 
                 // Force reflow/repaint
                 requestAnimationFrame(() => {
                   // Animate to new height and fade in
                   currentHeight = newHeight;
                   swapping = false;
                   
                   // Reset to auto after transition ends (300ms)
                   setTimeout(() => { currentHeight = 'auto' }, 300);
                 });
               });
             }
           "
           :style="`height: ${currentHeight}`"
           x-transition:enter="transition ease-out-back duration-300 transform"
           x-transition:enter-start="opacity-0 scale-90 translate-y-4"
           x-transition:enter-end="opacity-100 scale-100 translate-y-0"
           x-transition:leave="transition ease-in-back duration-150 transform"
           x-transition:leave-start="opacity-100 scale-100 translate-y-0"
           x-transition:leave-end="opacity-0 scale-90 translate-y-4"
           class="relative w-full max-w-lg bg-surface border border-border rounded-3xl shadow-2xl overflow-hidden text-left align-middle transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]">
           
        <div id="modal-content" 
             class="p-8 transition-opacity duration-200"
             :class="{ 'opacity-0': swapping, 'opacity-100': !swapping }">
          <!-- Content injected via HTMX -->
        </div>
      </div>
    </div>
  </div>

  <script>
      // No animations - Timeless Design
    </script>
  </body>
</html>
